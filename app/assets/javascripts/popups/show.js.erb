// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.


$(document).on('pageshow', '.popup_show', function(event){	
	$.mobile.loading('show');
	var theme = settings.theme
	// Initialize Fields
	$(".jqxInput").jqxInput({height: '20px', width: '100%', minLength: 1, theme: theme, disabled: true });
	$(".jqxNumberInput").jqxNumberInput({height: '20px', digits: 4, width: '100%', minLength: 1, theme: theme, disabled: true });
	$(".jqxNumberInput.currency").jqxNumberInput({decimalDigits: 2, symbol: '$'})
	
	$(".jqxDateTimeInput").jqxDateTimeInput({ width: '100%', height: '20px', theme: theme, disabled: true });

	$(".jqxDropDownList").jqxDropDownList({ source: {}, valueMember: 'value', displayMember: 'html', width: '100%',  height: '20px', theme: theme, disabled: true });
	$(".jqxDropDownList").jqxDropDownList('selectIndex', 0 ); 
	$(".jqxButton").jqxButton({ theme: theme, width:'75px' });

	$(".jqxToggle").jqxToggleButton({ theme: theme, width:'75px', disabled: true});               
    $(".jqxToggle").bind('click', function () {    	    	    
    	if ($(this).attr("disabled") != "disabled"){
	        var toggled = $(this).jqxToggleButton('toggled');
	        if (toggled) {
	            $(this).val(1);
	            $(this).html('On');
	        }
	        else {
	        	$(this).val(0);
	        	$(this).html('Off');
	        }
	    }
    });

    // Load record data
	var url =  system.server + $('.ui-page-active').attr('data-url')
	$.ajax({
		url: url,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {			
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});

			var item = $(element).jqxDropDownList('getItemByValue', data['record'][value.id]);
			$(element).jqxDropDownList('selectItem', item ); 
		});

		$.each($('.jqxInput'), function(key, value){		
			$('#' + value.id).val(data['record'][value.id])
		});

		$.each($('.jqxNumberInput'), function(key, value){		
			$('#' + value.id).jqxNumberInput('setDecimal', data['record'][value.id]);
		});

		$.each($('.jqxDateTimeInput'), function(key, value){		
			element = $('#' + value.id)			
			
			$(element).jqxDateTimeInput('setDate', new Date(data['record'][value.id])); 
			$(element).jqxDateTimeInput({ disabled:true });

		});

		$.each($('.jqxToggle'), function(key, value){
			element = $('#' + value.id)
			element.val(data['record'][value.id])
	        if (element.val() == 1) {
				$(element).jqxToggleButton('toggle'); 
				$(element).html('On');				
	        }
	        else {
	        	$(this).html('Off');
	        }
		});		
		$.mobile.loading('hide');

	})

	
	$(".edit").click(function () {
		document.location.href = url + '/edit'
	});
	
	$(".save").jqxButton({disabled:true})
	$(".cancel").click(function () {
//		window.parent.dataAdapter.dataBind();					
		window.parent.$('.jqxWindow').jqxWindow('close');

	});
});
