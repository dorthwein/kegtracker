// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
$(document).on('pageshow', '#popup_show', function(event){	
	var theme = settings.theme
	$(".jqxInput").jqxInput({height: '20px', width: '100%', minLength: 1, theme: theme, disabled: true });
	$(".jqxDropDownList").jqxDropDownList({ source: {}, valueMember: 'value', displayMember: 'html', width: '100%',  height: '20px', theme: theme, disabled: true });
	$(".jqxButton").jqxButton({ theme: theme, width:'75px' });
	$(".jqxToggle").jqxToggleButton({ theme: theme, width:'75px', disabled: true});               

    $(".jqxToggle").bind('click', function () {    	    	    
    	if ($(this).attr("disabled") != "disabled"){
	        var toggled = $(this).jqxToggleButton('toggled');
	        if (toggled) {
	            $(this).val(1);
	            $(this).html('On');
	        }
	        else {
	        	$(this).val(0);
	        	$(this).html('Off');
	        }
	    }
    });

	var url =  system.server + $('.ui-page-active').attr('data-url')
	$.ajax({
		url: url,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {			
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});

			var item = $(element).jqxDropDownList('getItemByValue', data['record'][value.id]);
			$(element).jqxDropDownList('selectItem', item ); 
		});

		$.each($('.jqxInput'), function(key, value){		
			$('#' + value.id).val(data['record'][value.id])
		});

		$.each($('.jqxToggle'), function(key, value){
			element = $('#' + value.id)
			element.val(data['record'][value.id])
	        if (element.val() == 1) {
				$(element).jqxToggleButton('toggle'); 
				$(element).html('On');				
	        }
	        else {
	        	$(this).html('Off');
	        }
		});		
	})

	

	$("#edit").click(function () {
		$.each($('.jqxDropDownList'), function(key, value){
			$('#' + value.id).jqxDropDownList({disabled:false});			
		})
		$.each($('.jqxInput'), function(key, value){
			$('#' + value.id).jqxInput({disabled:false});			
		})
		$.each($('.jqxToggle'), function(key, value){
			$('#' + value.id).jqxToggleButton({disabled:false});									
		})
		$('.jqxToggle').jqxToggleButton('refresh'); 
		$("#save").jqxButton({disabled:false})
	});
	


	$("#save").jqxButton({disabled:true})
	$("#save").click(function () {
		$.mobile.loading('show');		
        var params = {record: {}}
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			params['record'][value.id] = $(element).jqxDropDownList('getSelectedItem').value              				
		})

		$.each($('.jqxInput'), function(key, value){
			element = $('#' + value.id)
			params['record'][value.id] = $(element).val();
		})

		$.each($('.jqxToggle'), function(key, value){
			element = $('#' + value.id)
			params['record'][value.id] = $(element).val();
		})

		var url =  system.server + $('.ui-page-active').attr('data-url') + '.json';
//		url = url.substring(0, url.length - 4) + '.json';		    
		$.ajax({
			type: "PUT",
			dataType : "JSON",
			url: url,
			data: params,
		}).done(function( data ) {						
			var jqxgrid = window.opener.dataAdapter
			jqxgrid.dataBind();
			window.close();
		})
	});
	$("#cancel").click(function () {
		window.close()
	});
});
