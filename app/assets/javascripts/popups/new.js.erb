// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.

$(document).on('pageshow', '.popup_new', function(event){	
	$.mobile.loading('show');	
	jqxIntialize()

	var url =  system.server + $('.ui-page-active').attr('data-url')
	$.ajax({
		url: url,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {			
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});			
			$(element).jqxDropDownList('selectIndex', 0);
		});

		$.each($('.jqxListBox'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxListBox({source: data['jqxListBoxes'][value.id]});			
			$(element).jqxListBox('selectIndex', 0);
		});

//		$(".jqxGrid").jqxGrid({});

		$.mobile.loading('hide');
	});

	$(".save").click(function () {		
		if(	$('.jqxValidator').jqxValidator('validate')){
			$.mobile.loading('show');		
	        var params = {record: {}}
			$.each($('.jqxDropDownList'), function(key, value){
				element = $('#' + value.id)				
				if($(element).jqxDropDownList('getSelectedItem')){
					params['record'][value.id] = $(element).jqxDropDownList('getSelectedItem').value              				
				}
			})

			$.each($('.jqxInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})

			$.each($('.jqxNumberInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxNumberInput('getDecimal');
			})

			$.each($('.jqxDateTimeInput'), function(key, value){		
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxDateTimeInput('getDate'); 
			});


			$.each($('.jqxToggle'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})

			var url =  system.server + $('.ui-page-active').attr('data-url');
			url = url.substring(0, url.length - 4) + '.json';
						
			$.ajax({
				type: "POST",
				dataType : "JSON",
				url: url,
				data: params,
			}).done(function( data ) {						
//				var jqxGrid = window.opener.dataAdapter
//				jqxGrid.dataBind();
				window.parent.dataAdapter.dataBind();					
				window.parent.$('.jqxWindow').jqxWindow('close');
			})
		}
	});


	$(".cancel").click(function () {		
		window.parent.$('.jqxWindow').jqxWindow('close');
//		window.close()
	});
});
