// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.


function new_popup(){	 	
	jqxIntialize()
	$.ajax({
		url: location.href,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {			
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});			
			$(element).jqxDropDownList('selectIndex', 0);
		});

		$.each($('.jqxListBox'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxListBox({source: data['jqxListBoxes'][value.id]});			
			$(element).jqxListBox('selectIndex', 0);
		});
		 
	});

	$(".save").click(function () {		
		if(	$('.jqxValidator').jqxValidator('validate')){
			 		
	        var params = {record: {}}
			$.each($('.jqxDropDownList'), function(key, value){
				element = $('#' + value.id)				
				if($(element).jqxDropDownList('getSelectedItem')){
					params['record'][value.id] = $(element).jqxDropDownList('getSelectedItem').value              				
				}
			})

			$.each($('.jqxInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})

			$.each($('.jqxNumberInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxNumberInput('getDecimal');
			})

			$.each($('.jqxDateTimeInput'), function(key, value){		
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxDateTimeInput('getDate'); 
			});


			$.each($('.jqxToggle'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})

						
			$.ajax({
				type: "POST",
				dataType : "JSON",
				url: location.href.substring(0, location.href.length - 4),
				data: params,
			}).done(function( data ) {						
				window.parent.dataAdapter.dataBind();					
				window.parent.$('.jqxWindow').jqxWindow('close');
			})
		}
	});


	$(".cancel").click(function () {		
		window.parent.$('.jqxWindow').jqxWindow('close');
//		window.close()
	});
};
