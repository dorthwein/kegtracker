// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
//$(document).on('pageshow', '.popup_edit', function(event){		 
function edit_popup(){
	var theme = settings.theme	
	jqxIntialize();
	var record_url = location.href.slice(0, location.href.length - 5);
	$.ajax({
		url: location.href,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {
		$.each($('.jqxDropDownList'), function(key, value){			
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});

			var item = $(element).jqxDropDownList('getItemByValue', data['record'][value.id]);
			$(element).jqxDropDownList('selectItem', item ); 						
		});

		$.each($('.jqxListBox'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxListBox({source: data['jqxListBoxes'][value.id]});			
			$(element).jqxListBox('selectIndex', 0);
		});


		$.each($('.jqxInput'), function(key, value){		
			$('#' + value.id).val(data['record'][value.id])
		});
		$.each($('.jqxNumberInput'), function(key, value){		
			$('#' + value.id).jqxNumberInput('setDecimal', data['record'][value.id]);
		});		

		$.each($('.jqxDateTimeInput'), function(key, value){		
			element = $('#' + value.id)			
			$(element).jqxDateTimeInput('setDate', new Date(data['record'][value.id])); 
		});

		$.each($('.jqxToggle'), function(key, value){
			element = $('#' + value.id)
			element.val(data['record'][value.id])
	        if (element.val() == 1) {
				$(element).jqxToggleButton('toggle'); 
				$(element).html('On');				
	        }
	        else {
	        	$(this).html('Off');
	        }
		});		
		 
	});

	$(".view").click(function () {	
		document.location.href = record_url
	});
		
	$(".save").click(function () {
		if(	$('.jqxValidator').jqxValidator('validate') ){		
			 		
	        var params = {record: {}}
			$.each($('.jqxDropDownList'), function(key, value){
				element = $('#' + value.id)	
				if($(element).jqxDropDownList('getSelectedItem')){
					params['record'][value.id] = $(element).jqxDropDownList('getSelectedItem').value	
				}			
				
			})

			$.each($('.jqxInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})

			$.each($('.jqxNumberInput'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxNumberInput('getDecimal');
			})			
	
			$.each($('.jqxDateTimeInput'), function(key, value){		
				element = $('#' + value.id)
				params['record'][value.id] = $(element).jqxDateTimeInput('getDate'); 
			});
		

			$.each($('.jqxToggle'), function(key, value){
				element = $('#' + value.id)
				params['record'][value.id] = $(element).val();
			})
			$.ajax({
				type: "PUT",
				dataType : "JSON",
				url: record_url,
				data: params,
			}).done(function( data ) {						
				window.parent.dataAdapter.dataBind();					
				window.parent.$('.jqxWindow').jqxWindow('close');

//				window.opener.dataAdapter.dataBind();
				window.close();
			})
		};
	});
	$(".cancel").click(function () {
		window.parent.$('.jqxWindow').jqxWindow('close');
	});
};
