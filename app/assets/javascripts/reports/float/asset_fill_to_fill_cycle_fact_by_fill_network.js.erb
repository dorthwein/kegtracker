// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.

$(document).on('pageshow', '#_reports_float_asset_fill_to_fill_cycle_fact_by_fill_network', function(event){	
	// prepare the data
	$.mobile.loading('show');
	var theme = settings.theme

	var theme = settings.theme
	var source = {
		datatype : "json",
		type: 'POST',
		datafields: [
//			{ name: 'date' },																	
//			{ name: 'fill_network' },
//			{ name: 'sku' },
			{ name: 'fill_network_description' },
			{ name: 'product_description' },			
			{ name: 'asset_type_description' },
			{ name: 'product_entity_description' },
			{ name: 'avg_time' },
			{ name: 'min_time' },
			{ name: 'max_time' },
			{ name: '_id' }
		],
		url: system.server + $('.ui-page-active').attr('data-url') + '.json',			
		root: 'grid',
	};

	var dataAdapter = new $.jqx.dataAdapter(source, {
		formatData: function(){
		    var params = {}			
		    
		    var jsDate = $('#date').jqxDateTimeInput('getDate'); 
		    params['date'] = jsDate;

			var item = $("#fill_network_id").jqxDropDownList('getSelectedItem');
			if(item != undefined){
				params['fill_network_id'] = item.value				
			}			
			
		    return params	    
		},
		downloadComplete: function(edata, textStatus, jqXHR){		
		    var jsDate = $('#date').jqxDateTimeInput('getDate'); 
		    params['date'] = jsDate;
			
			$("#fill_network_id").jqxDropDownList({ source: edata['fill_networks']});
			
			if($("#fill_network_id").jqxDropDownList('getSelectedItem') == null){								
				var x = $("#fill_network_id").jqxDropDownList('getItemByValue', edata['fill_networks'][0].value);
				$("#fill_network_id").jqxDropDownList('selectItem', x );				
			}
			var item = $("#fill_network_id").jqxDropDownList('getSelectedItem')
			$('#displayNetwork').html(item.html);
			$('#displayDate').html(jsDate.toDateString());
		}
	});

	// Initialize Grid	
	$("#jqxgrid").jqxGrid({		
		groupable: false,
		sortable: true,
		filterable: false,
        showfilterrow: false,		
		autoshowfiltericon: false,		
		theme: theme,
		width: system.simple_grid_width,
		groupsexpandedbydefault: false,
		height: system.simple_grid_height,
		source: dataAdapter,
		columnsresize: true,
		altrows: true,	
		ready: function() {

		},

			


		columns: [																						
			//{ text: 'Fill Network', width:'250px', datafield: 'fill_network_description', filtertype: 'checkedlist'  },
			{ text: 'Product',  datafield: 'product_description', filtertype: 'checkedlist'  },
			{ text: 'Brewery',  datafield: 'product_entity_description', filtertype: 'checkedlist'  },
			{ text: 'Asset Type',  datafield: 'asset_type_description', filtertype: 'checkedlist' },
			{ text: 'Min (Days)', width:'100px', datafield: 'min_time', filtertype: 'number'  },
			{ text: 'Max (Days)', width:'100px', datafield: 'max_time', filtertype: 'number' },
			{ text: 'Avg. (Days)', width:'100px', datafield: 'avg_time', filtertype: 'number' },
		],
        groups: ['date','fill_network']
	});


	$("#date").jqxDateTimeInput({ width: '150px', height: '20px', theme: theme });
	$('#date').bind('valuechanged', function (event) {  
		
	//	var jsDate = event.args.date; 		
	}); 

	$("#fill_network_id").jqxDropDownList({ source: {}, valueMember: 'value', displayMember: 'html', width: '200px',  height: '20px', theme: theme, disabled: false });
/*
	$('#fill_network_id').bind('select', function (event) {
	    var args = event.args;
	    if (args) {
	        // index represents the item's index.                
	        var index = args.index;
	        var item = args.item;
	        // get item's label and value.
	        var label = item.label;
	        var value = item.value;
	    
	    }
	});
*/


	$("#excelExport").jqxButton({ theme: theme });	
	$("#advancedView").jqxButton({ theme: theme });
	$("#simpleView").jqxButton({ theme: theme });
	
	$("#findRecord").jqxButton({ theme: theme });	
	$("#findRecord").click(function () {		
		dataAdapter.dataBind();
//		alert(JSON.stringify($("#jqxgrid").jqxGrid('getrows')));		
	});

	
	// NEW BUTTON


	$("#excelExport").click(function () {
//		alert(JSON.stringify($("#jqxgrid").jqxGrid('getrows')));
		$("#jqxgrid").jqxGrid('exportdata', 'xls', 'jqxGrid');           
	});


	$.mobile.loading('hide');
});
