// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.

$(document).on('pageshow', '#_reports_locations', function(event){	
	// prepare the data
	$.mobile.loading('show');
	theme = settings.theme;
	// Grid data source
	var grid_source = {
		datatype : "json",
		type: 'GET',		
		datafields: [
			{ name: 'externalID' },
			{ name: 'description' },
			{ name: 'network_description' }, 
			{ name: 'name' },
			{ name: 'street' },
			{ name: 'city' },
			{ name: 'state' },					
			{ name: 'zip' },                	
			{ name: 'location_type' },                	
			{ name: 'location_type_description' },                	
			{ name: '_id'},
			{ name: 'asset_count'}
		], 
		url: system.server + $('.ui-page-active').attr('data-url') + '.json'
	};
	var dataAdapter = new $.jqx.dataAdapter(grid_source, {

		loadComplete: function (data) {},
		loadError: function (xhr, status, error) { }      
	});
	// Initiate grid
	var gridSettings = settings.jqxGridProperties
	gridSettings['source'] = dataAdapter;
	gridSettings['columns'] = [	
		{ text: 'Act #', datafield: 'externalID' },
		{ text: 'Location', datafield: 'description' },
		{ text: 'Network', datafield: 'network_description', filtertype: 'checkedlist' },

		{ text: 'Name', datafield: 'name' },
		{ text: 'Address', datafield: 'street' },
		{ text: 'City', datafield: 'city' },
		{ text: 'State', datafield: 'state', filtertype: 'checkedlist' },			
		{ text: 'Zip', datafield: 'zip' },
		{ text: 'Type', datafield: 'location_type_description', filtertype: 'checkedlist' },			
		{ text: '# Assets', width:75, datafield: 'asset_count', filtertype: 'number' },			
		{ text: 'View', datafield: '_id', columntype: 'button', filterable:false, width:'75px', cellsrenderer: function (row) {
			return 'View'
		}, buttonclick: function (row) {
			var rowdata = $('.jqxGrid').jqxGrid('getrowdata', row);
			var url = $('.ui-page-active').attr('data-url') + "/" + rowdata['_id'] + "/edit"						
			openPopupWindow(url)
		}},	

	]
	
	$(".jqxGrid").jqxGrid( gridSettings );	
	jqxIntialize()
	$.mobile.loading('hide');					

});
