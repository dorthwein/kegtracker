$(document).on('pageshow', '#_reports_assets', function(event){	
	$.mobile.loading('show');
	var theme = settings.theme
	
	url = system.server + $('.ui-page-active').attr('data-url') + '.json'	
	var source =
	{
		datatype: "json",
		datafields: [
			{ name: 'entity_description', type: 'string' },
			{ name: 'product_entity_description', type: 'string' },
			{ name: 'tag_value', type: 'string' },
			{ name: 'asset_type_description', type: 'string' },
			{ name: 'asset_status_description', type: 'string' },
			{ name: 'product_description', type: 'string' },
			{ name: 'location_description', type: 'string' },
			{ name: 'location_network_description', type: 'string' },
			{ name: '_id' },
			{ name: 'fill_time', type: 'date' },
			{ name: 'last_action_time', type: 'date' },
			{ name: 'asset_cycle_fact_id'},
			{ name: '_id'},
		],
		url: url,
		updaterow: function (rowid, rowdata, commit) {
			// synchronize with the server - send update command
			// call commit with parameter true if the synchronization with the server is successful 
			// and with parameter false if the synchronization failder.		
			commit(true);
		}		
	};
/*
	On grid load - get total # rows
*/


	window.dataAdapter = new $.jqx.dataAdapter(source, {
		beforeSend: function(jqXHR, settings){		
			$.mobile.loading('show');	
		},
		loadComplete: function (data) { 
			$.mobile.loading('hide');
		},
		loadError: function (xhr, status, error) { }      
	});
//	window.dataAdapter = dataAdapter

	// Initialize Grid
	var gridSettings = settings.jqxGridProperties
	gridSettings['source'] = dataAdapter;
	gridSettings['columns'] = [
		{ text: 'Owner', datafield: 'entity_description', filtertype: 'checkedlist' },			
		{ text: 'Product', datafield: 'product_description', filtertype: 'checkedlist' },			
		{ text: 'Size', datafield: 'asset_type_description', filtertype: 'checkedlist' },
		{ text: 'Brewery', datafield: 'product_entity_description', filtertype: 'checkedlist' },			
		{ text: 'Fill Date', datafield: 'fill_time', filtertype: 'date', cellsformat: 'd'  },
		{ text: 'Tag Value', datafield: 'tag_value' },
		{ text: 'Status', datafield: 'asset_status_description', filtertype: 'checkedlist' },			
		{ text: 'Location', datafield: 'location_description', filtertype: 'checkedlist' },
		{ text: 'Location Network', datafield: 'location_network_description', filtertype: 'checkedlist' },
		{ text: 'Last Scene', datafield: 'last_action_time', filtertype: 'date', cellsformat: 'd'  },
		{ text: 'Cycle', datafield: 'asset_cycle_fact_id', columntype: 'button', filterable:false, width:'75px', cellsrenderer: function (row) {
			return 'Cycle'
		}, buttonclick: function (row) {
			var rowdata = $('.jqxGrid').jqxGrid('getrowdata', row);
			var url = system.server + "/reports/asset_cycles/" + rowdata['asset_cycle_fact_id'] 
			openPopupWindow(url)	//	http://localhost:3000/reports/active_asset_cycles
		}},	


		{ text: 'View', datafield: '_id', columntype: 'button', filterable:false, width:'75px', cellsrenderer: function (row) {
			return 'View'
		}, buttonclick: function (row) {
			var rowdata = $('.jqxGrid').jqxGrid('getrowdata', row);
			var url = $('.ui-page-active').attr('data-url') + "/" + rowdata['_id'] + "/edit"						
			openPopupWindow(url)
		}},	
	]

	$(".jqxGrid").jqxGrid( gridSettings );	
	jqxIntialize()
	$.mobile.loading('hide');					
});


