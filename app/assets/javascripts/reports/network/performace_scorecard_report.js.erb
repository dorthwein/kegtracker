// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.

// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
$(document).on('pageshow', '#_reports_network_performance_scorecard_report', function(event){	

	// prepare the data
	$.mobile.loading('show');

	var theme = settings.theme
	$("#date").jqxDateTimeInput({ width: '150px', height: '20px', theme: theme });
	$('#date').bind('valuechanged', function (event) {  
		
	//	var jsDate = event.args.date; 		
	}); 

	var source = {
		datatype : "json",
		type: 'POST',
		datafields: [
			{name: 'location_network_description'},
			{name: 'product_entity_description'}, 	
			{name: 'product_description'},			
			{name: 'fact_time'}, 					
			{name: 'asset_type_description'}, 		
			{name: 'sku_description'}, 			
			{name: 'sku_id'}, 						
			{name: 'fill_quantity'},				
			{name: 'delivery_quantity'}, 			
			{name: 'pickup_quantity'}, 			
			{name: 'move_quantity'}, 				
			{name: 'empty_quantity'}, 				
			{name: 'full_quantity'}, 				
			{name: 'market_quantity'}, 			
			{name: 'total_quantity'}, 				
			{name: 'life_cycle_max_time'}, 	
			{name: 'life_cycle_avg_time'}, 	
			{name: 'life_cycle_min_time'}, 	
			{name: 'life_cycle_completed_cycles'}, 
			{name: 'in_full_quantity'}, 			
			{name: 'in_market_quantity'}, 			
			{name: 'in_empty_quantity'}, 			
			{name: 'in_total_quantity'}, 				
			{name: 'out_full_quantity'}, 			
			{name: 'out_market_quantity'}, 		
			{name: 'out_empty_quantity'}, 			
			{name: 'out_total_quantity'}, 			
		],
		url: system.server + $('.ui-page-active').attr('data-url') + '.json',			
		root: 'grid',
	};

	var dataAdapter = new $.jqx.dataAdapter(source, {
		formatData: function(){
		    var params = {}			
		    
		    var jsDate = $('#date').jqxDateTimeInput('getDate'); 
		    params['date'] = jsDate;

			var item = $("#network_id").jqxDropDownList('getSelectedItem');
			if(item != undefined){
				params['network_id'] = item.value				
			}			
		    return params	    
		},
		downloadComplete: function(edata, textStatus, jqXHR){		
		    var jsDate = $('#date').jqxDateTimeInput('getDate'); 
		    params['date'] = jsDate;
			
			$("#network_id").jqxDropDownList({ source: edata['networks']});
			
			if($("#network_id").jqxDropDownList('getSelectedItem') == null){								
				var x = $("#network_id").jqxDropDownList('getItemByValue', edata['networks'][0].value);
				$("#network_id").jqxDropDownList('selectItem', x );				
			}
			var item = $("#network_id").jqxDropDownList('getSelectedItem')
//			$('#displayNetwork').html(item.html);
			$('#displayDate').html(jsDate.toDateString());
		}
	});

	// Initialize Grid	
	$("#lifecyles").jqxGrid({	
		showgroupsheader: false,
		groupable: true,
		closeablegroups: false,
    	groupsrenderer: default_groupsrenderer,		
		sortable: true,
		filterable: false,
        showfilterrow: false,		
		autoshowfiltericon: false,		
		theme: theme,
		width: 958, // system.simple_grid_width,
		groupsexpandedbydefault: true,
		height: 400,
		source: dataAdapter,
		columnsresize: true,
		altrows: true,	
		root: 'grid',
		ready: function() {
		},
		columns: [	
			{text: 'Product', 		datafield: 'product_description'},			
			{text: 'Container', 	datafield: 'asset_type_description'}, 				
			{text: 'Min (Days)', 	width:85, datafield: 'life_cycle_min_time'}, 	
			{text: 'Avg (Days)', 	width:85, datafield: 'life_cycle_avg_time'}, 	
			{text: 'Max (Days)', 	width:85, datafield: 'life_cycle_max_time'}, 							
			{text: 'Cycles', 		width:85, datafield: 'life_cycle_completed_cycles'}, 

//			{text: 'First', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Rank', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Last', datafield: 'life_cycle_completed_cycles'}, 
			
/*
			{text: 'SKU', datafield: 'sku_description'}, 			
			{text: ' ', datafield: 'sku_id'}, 						
			{text: 'Fill Qty', datafield: 'fill_quantity'},				
			{text: 'Delivery Qty', datafield: 'delivery_quantity'}, 			
			{text: 'Pickup Qty', datafield: 'pickup_quantity'}, 			
			{text: 'Move Qty', datafield: 'move_quantity'}, 				
			{text: 'Empty Qty', datafield: 'empty_quantity'}, 				
			{text: 'Full Qty', datafield: 'full_quantity'}, 				
			{text: 'Market Qty', datafield: 'market_quantity'}, 			
			{text: 'Total Qty', datafield: 'total_quantity'}, 				
			{text: 'Max Cycle', datafield: 'life_cycle_cycle_max_time'}, 	
			{text: 'Avg Cycle', datafield: 'life_cycle_cycle_avg_time'}, 	
			{text: 'Min Cycle', datafield: 'life_cycle_cycle_min_time'}, 	
			{text: '# Cycles', datafield: 'life_cycle_completed_cycles'}, 
*/
/*
			{text: '', datafield: 'in_full_quantity'}, 			
			{text: '', datafield: 'in_market_quantity'}, 			
			{text: '', datafield: 'in_empty_quantity'}, 			
			{text: '', datafield: 'in_total_quantity'}, 			
			{text: '', datafield: 'out_full_quantity'}, 			
			{text: '', datafield: 'out_market_quantity'}, 		
			{text: '', datafield: 'out_empty_quantity'}, 			
			{text: '', datafield: 'out_total_quantity'}, 	

			{ text: 'Product', 		width:'250px', datafield: 'product', filtertype: 'checkedlist'  },
			{ text: 'Brewery',		datafield: 'product_entity', filtertype: 'checkedlist'  },
			{ text: 'Container', datafield: 'asset_type', filtertype: 'checkedlist' },		
//			{ text: 'In - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'in_full_quantity' },			
//			{ text: 'In - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },			
//			{ text: 'In - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'in_empty_quantity' },						
			{ text: 'In Bound',			cellsalign: 'center',	width:'100px',	datafield: 'in_total_quantity' },
//			{ text: 'Out - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'out_full_quantity' },			
//			{ text: 'Out - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },
//			{ text: 'Out - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'out_empty_quantity' },						
			{ text: 'Out Bound', 			cellsalign: 'center',	width:'100px',	datafield: 'out_total_quantity' }
*/
		],
        groups: ['asset_type_description']
        
	});

	$("#activity_summary").jqxGrid({	
		showgroupsheader: false,
		groupable: true,
		closeablegroups: false,
    	groupsrenderer: default_groupsrenderer,		
		sortable: true,
		filterable: false,
        showfilterrow: false,		
		autoshowfiltericon: false,		
		theme: theme,
		width: 958, // system.simple_grid_width,
		groupsexpandedbydefault: true,
		height: 400,
		source: dataAdapter,
		columnsresize: true,
		altrows: true,	
		root: 'grid',
		ready: function() {
		},
		columns: [	
			{text: 'Product', 		datafield: 'product_description'},			
			{text: 'Container',	datafield: 'asset_type_description'}, 				
			{text: 'Fills', 		width:80, datafield: 'fill_quantity'},				
			{text: 'Deliveries', 	width:80, datafield: 'delivery_quantity'}, 			
			{text: 'Pickups', 		width:80, datafield: 'pickup_quantity'}, 			
			{text: 'Moves', 		width:80, datafield: 'move_quantity'}, 				
			
//			{text: 'First', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Rank', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Last', datafield: 'life_cycle_completed_cycles'}, 
			
/*
			{text: 'SKU', datafield: 'sku_description'}, 			
			{text: ' ', datafield: 'sku_id'}, 						
			{text: 'Fill Qty', datafield: 'fill_quantity'},				
			{text: 'Delivery Qty', datafield: 'delivery_quantity'}, 			
			{text: 'Pickup Qty', datafield: 'pickup_quantity'}, 			
			{text: 'Move Qty', datafield: 'move_quantity'}, 				
			{text: 'Empty Qty', datafield: 'empty_quantity'}, 				
			{text: 'Full Qty', datafield: 'full_quantity'}, 				
			{text: 'Market Qty', datafield: 'market_quantity'}, 			
			{text: 'Total Qty', datafield: 'total_quantity'},
			{text: 'Max Cycle', datafield: 'life_cycle_cycle_max_time'}, 	
			{text: 'Avg Cycle', datafield: 'life_cycle_cycle_avg_time'}, 	
			{text: 'Min Cycle', datafield: 'life_cycle_cycle_min_time'}, 	
			{text: '# Cycles', datafield: 'life_cycle_completed_cycles'}, 
*/
/*
			{text: '', datafield: 'in_full_quantity'}, 			
			{text: '', datafield: 'in_market_quantity'}, 			
			{text: '', datafield: 'in_empty_quantity'}, 			
			{text: '', datafield: 'in_total_quantity'}, 			
			{text: '', datafield: 'out_full_quantity'}, 			
			{text: '', datafield: 'out_market_quantity'}, 		
			{text: '', datafield: 'out_empty_quantity'}, 			
			{text: '', datafield: 'out_total_quantity'}, 	

			{ text: 'Product', 		width:'250px', datafield: 'product', filtertype: 'checkedlist'  },
			{ text: 'Brewery',		datafield: 'product_entity', filtertype: 'checkedlist'  },
			{ text: 'Container', datafield: 'asset_type', filtertype: 'checkedlist' },		
//			{ text: 'In - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'in_full_quantity' },			
//			{ text: 'In - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },			
//			{ text: 'In - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'in_empty_quantity' },						
			{ text: 'In Bound',			cellsalign: 'center',	width:'100px',	datafield: 'in_total_quantity' },
//			{ text: 'Out - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'out_full_quantity' },			
//			{ text: 'Out - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },
//			{ text: 'Out - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'out_empty_quantity' },						
			{ text: 'Out Bound', 			cellsalign: 'center',	width:'100px',	datafield: 'out_total_quantity' }
*/
		],
        groups: ['asset_type_description']
        
	});

	$("#sku_summary").jqxGrid({	
		showgroupsheader: false,
		groupable: true,
		closeablegroups: false,
    	groupsrenderer: default_groupsrenderer,		
		sortable: true,
		filterable: false,
        showfilterrow: false,		
		autoshowfiltericon: false,		
		theme: theme,
		width: 958, // system.simple_grid_width,
		groupsexpandedbydefault: true,
		height: 400,
		source: dataAdapter,
		columnsresize: true,
		altrows: true,	
		root: 'grid',
		ready: function() {

		},
		columns: [	
			{text: 'Product', 		datafield: 'product_description'},			
			{text: 'Container', 	datafield: 'asset_type_description'}, 				
			{text: 'Empty', 		width:80, datafield: 'empty_quantity'}, 				
			{text: 'Full', 			width:80, datafield: 'full_quantity'}, 				
			{text: 'Market', 		width:80, datafield: 'market_quantity'}, 			
			{text: 'Total', 		width:80, datafield: 'total_quantity'},

//			{text: 'First', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Rank', datafield: 'life_cycle_completed_cycles'}, 
//			{text: 'Last', datafield: 'life_cycle_completed_cycles'}, 
			
/*
			{text: 'SKU', datafield: 'sku_description'}, 			
			{text: ' ', datafield: 'sku_id'}, 						
			{text: 'Fill Qty', datafield: 'fill_quantity'},				
			{text: 'Delivery Qty', datafield: 'delivery_quantity'}, 			
			{text: 'Pickup Qty', datafield: 'pickup_quantity'}, 			
			{text: 'Move Qty', datafield: 'move_quantity'}, 				
			{text: 'Empty Qty', datafield: 'empty_quantity'}, 				
			{text: 'Full Qty', datafield: 'full_quantity'}, 				
			{text: 'Market Qty', datafield: 'market_quantity'}, 			
			{text: 'Total Qty', datafield: 'total_quantity'},
			{text: 'Max Cycle', datafield: 'life_cycle_cycle_max_time'}, 	
			{text: 'Avg Cycle', datafield: 'life_cycle_cycle_avg_time'}, 	
			{text: 'Min Cycle', datafield: 'life_cycle_cycle_min_time'}, 	
			{text: '# Cycles', datafield: 'life_cycle_completed_cycles'}, 
*/
/*
			{text: '', datafield: 'in_full_quantity'}, 			
			{text: '', datafield: 'in_market_quantity'}, 			
			{text: '', datafield: 'in_empty_quantity'}, 			
			{text: '', datafield: 'in_total_quantity'}, 			
			{text: '', datafield: 'out_full_quantity'}, 			
			{text: '', datafield: 'out_market_quantity'}, 		
			{text: '', datafield: 'out_empty_quantity'}, 			
			{text: '', datafield: 'out_total_quantity'}, 	

			{ text: 'Product', 		width:'250px', datafield: 'product', filtertype: 'checkedlist'  },
			{ text: 'Brewery',		datafield: 'product_entity', filtertype: 'checkedlist'  },
			{ text: 'Container', datafield: 'asset_type', filtertype: 'checkedlist' },		
//			{ text: 'In - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'in_full_quantity' },			
//			{ text: 'In - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },			
//			{ text: 'In - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'in_empty_quantity' },						
			{ text: 'In Bound',			cellsalign: 'center',	width:'100px',	datafield: 'in_total_quantity' },
//			{ text: 'Out - Full', 			cellsalign: 'center',	width:'75px',	datafield: 'out_full_quantity' },			
//			{ text: 'Out - Market/Empty', 	cellsalign: 'center',	width:'75px',	datafield: 'out_market_or_empty_quantity' },
//			{ text: 'Out - Empty', 			cellsalign: 'center',	width:'75px',	datafield: 'out_empty_quantity' },						
			{ text: 'Out Bound', 			cellsalign: 'center',	width:'100px',	datafield: 'out_total_quantity' }
*/
		],
        groups: ['asset_type_description']
        
	});


	$("#network_id").jqxDropDownList({ source: {}, valueMember: 'value', displayMember: 'html', width: '200px',  height: '20px', theme: theme, disabled: false });

	$('#network_id').bind('select', function (event) {
	    var args = event.args;
	    if (args) {
	        // index represents the item's index.                
	        var index = args.index;
	        var item = args.item;
	        // get item's label and value.
	        var label = item.label;
	        var value = item.value;
	    
	    }
	});
	$(".jqxExpander").jqxExpander({theme: theme, expanded: false });	
	$("#excelExport").jqxButton({ theme: theme });	
	$("#advancedView").jqxButton({ theme: theme });
	$("#simpleView").jqxButton({ theme: theme });
	
	$("#findRecord").jqxButton({ theme: theme });	
	$("#findRecord").click(function () {
		
		dataAdapter.dataBind();
//		alert(JSON.stringify($("#jqxgrid").jqxGrid('getrows')));		
	});

	// NEW BUTTON
	$("#excelExport").click(function () {
//		alert(JSON.stringify($("#jqxgrid").jqxGrid('getrows')));
		$("#jqxgrid").jqxGrid('exportdata', 'xls', 'jqxGrid');           
	});
	$.mobile.loading('hide');
});


