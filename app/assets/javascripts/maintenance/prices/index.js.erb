// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.


$(document).on('pageshow', '#_maintenance_prices', function(event){	
	$.mobile.loading('show');
	var theme = settings.theme
	
	url = system.server + $('.ui-page-active').attr('data-url') + '.json'	
	var source =
	{
		datatype: "json",
		datafields: [
			{name: 'sku_description'},
			{name: 'description'},
			{name: 'entity_description'},
//			{name: 'bill_to_entity_description'},		
			{name: 'price', type: 'number' },
			{name: 'sales_tax', type: 'number' },
			{name: 'gallonage_tax', type: 'number' },
			{name: 'total_tax', type: 'number' },
			{name: 'total', type: 'number' },
			{name: 'base_price_tier_description'},
			{name: '_id'}
		], 
		url: url,
		updaterow: function (rowid, rowdata, commit) {
			// synchronize with the server - send update command
			// call commit with parameter true if the synchronization with the server is successful 
			// and with parameter false if the synchronization failder.		
			commit(true);
		}		
	};

	window.dataAdapter = new $.jqx.dataAdapter(source, {
		beforeSend: function(jqXHR, settings){
			$.mobile.loading('show');	
		},
		loadComplete: function (data) { 
			$.mobile.loading('hide');
		},
		loadError: function (xhr, status, error) { }      
	});
//	window.dataAdapter = dataAdapter
	var currencyRenderer = function (row, columnfield, value, defaulthtml, columnproperties) {
		
	}

	// Initialize Grid
	var gridSettings = settings.jqxGridProperties
	gridSettings['source'] = dataAdapter;
	gridSettings['columns'] = [
		{text:'Description', datafield: 'description', width:'30%'},
		{text:'SKU', datafield: 'sku_description', filtertype: 'checkedlist'},		
//			{text:'Customer', datafield: 'bill_to_entity_description', filtertype: 'checkedlist'},
		{text:'Per', datafield: 'base_price_tier_description', width:100, filtertype: 'checkedlist'},		
		{text:'Price', datafield: 'price', width:100, cellsalign: 'right', cellsformat: 'c2' },
		{text:'Sales Tax', datafield: 'sales_tax', width:100, cellsalign: 'right', cellsformat: 'c2' },
		{text:'Gallonage Tax', datafield: 'gallonage_tax', width:100, cellsalign: 'right', cellsformat: 'c2' },
		{text:'Total', datafield: 'total', width:100, cellsalign: 'right', cellsformat: 'c2' },
		
		{ text: 'View', datafield: '_id', columntype: 'button', filterable:false, width:'75px', cellsrenderer: function (row) {
			return 'View'
		}, buttonclick: function (row) {
			var rowdata = $('.jqxGrid').jqxGrid('getrowdata', row);
			var url = $('.ui-page-active').attr('data-url') + "/" + rowdata['_id']						
			openPopupWindow(url)
		}},	
	]

	$(".jqxGrid").jqxGrid( gridSettings );	
	jqxIntialize()
	$.mobile.loading('hide');					
	

});


