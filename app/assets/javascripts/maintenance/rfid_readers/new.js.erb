// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.
$(document).on('pageshow', '#_system_asset_types_new', function(event){	
	var theme = settings.theme
	$(".jqxInput").jqxInput({height: '20px', width: '100%', minLength: 1, theme: theme, disabled: false });
	$(".jqxDropDownList").jqxDropDownList({ source: {}, valueMember: 'value', displayMember: 'html', width: '100%',  height: '20px', theme: theme, disabled: false });

	var url =  system.server + $('.ui-page-active').attr('data-url')
	$.ajax({
		url: url,
		type: "GET",
		dataType : "JSON",
		data: params,
	}).done(function( data ) {			
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			$(element).jqxDropDownList({source: data['jqxDropDownLists'][value.id]});
		});

	})	

	$("#save").jqxButton({ theme: theme, width:'45%' });            
	$("#save").click(function () {
		$.mobile.loading('show');		
        var params = {record: {}}
		$.each($('.jqxDropDownList'), function(key, value){
			element = $('#' + value.id)				
			params['record'][value.id] = $(element).jqxDropDownList('getSelectedItem').value              				
		})

		$.each($('.jqxInput'), function(key, value){
			element = $('#' + value.id)
			params['record'][value.id] = $(element).val();
		})

		$.each($('.jqxToggle'), function(key, value){
			element = $('#' + value.id)
			params['record'][value.id] = $(element).val();
		})

		var url =  system.server + $('.ui-page-active').attr('data-url');
		url = url.substring(0, url.length - 4) + '.json';		    
		$.ajax({
			type: "POST",
			dataType : "JSON",
			url: url,
			data: params,
		}).done(function( data ) {						
			var jqxgrid = window.opener.dataAdapter
			jqxgrid.dataBind();
			window.close();
		})
	});
	$("#cancel").jqxButton({ theme: theme, width:'45%' });            
	$("#cancel").click(function () {
		window.close()
	});
});
