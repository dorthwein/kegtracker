// # Place all the behaviors and hooks related to the matching controller here.
// # All this logic will automatically be available in application.js.	

$(document).on('pageshow', '#_maintenance_skus', function(event){	
	$.mobile.loading('show');
	var theme = settings.theme
	jqxIntialize()
	url = system.server + $('.ui-page-active').attr('data-url') + '.json'	
	var source =
	{
		datatype: "json",
		datafields: [
			{ name: 'item_number'},
			{ name: 'product_description'},
			{ name: 'primary_asset_type_description'},			

			{ name: 'tier_1_upc'},			
			{ name: 'tier_1_asset_type_description'},
			{ name: 'tier_1_qty_per_tier_2'},

			{ name: 'tier_2_upc'},
			{ name: 'tier_2_asset_type_description'},
			{ name: 'tier_2_qty_per_tier_3'},

			{ name: 'tier_3_upc'},
			{ name: 'tier_3_asset_type_description'},
			{ name: 'tier_3_qty_per_tier_4'},

			{ name: 'tier_4_upc'},
			{ name: 'tier_4_asset_type_description'},
			
			{ name: '_id' }
		], 
		url: url,
		updaterow: function (rowid, rowdata, commit) {
			// synchronize with the server - send update command
			// call commit with parameter true if the synchronization with the server is successful 
			// and with parameter false if the synchronization failder.		
			commit(true);
		}
// test		
	};

	window.dataAdapter = new $.jqx.dataAdapter(source, {
		beforeSend: function(jqXHR, settings){
			$.mobile.loading('show');	
		},
		loadComplete: function (data) { 
			$.mobile.loading('hide');
		},
		loadError: function (xhr, status, error) { }      
	});
//	window.dataAdapter = dataAdapter

	// Initialize Grid
	$(".jqxGrid").jqxGrid(
	{
		// Grid Options
		groupable: true,
		sortable: true,
		filterable: true,
		showfilterrow: true,		
        autoshowfiltericon: true,		
		theme: theme,
		width: '100%',
		groupsexpandedbydefault: true,
		height:  system.full_window_table_height(),
		source: dataAdapter,
		columnsresize: true,
		altrows: true,		
		columns: [
			{ text:'Item #', datafield: 'item_number'},
			{ text:'Product', datafield: 'product_description', filtertype: 'checkedlist' },
			{ text:'Primary Asset Type', datafield: 'primary_asset_type_description', filtertype: 'checkedlist' },

			{ text:'Unit', width: '8%', datafield: 'tier_1_asset_type_description', filtertype: 'checkedlist' },
			{ text:'UPC (Unit)', 	width: '8%', datafield: 'tier_1_upc'},
			{ text:'Unit/pack', width: '5%', datafield: 'tier_1_qty_per_tier_2'},

			{ text:'Consumer Pack', width: '8%', datafield: 'tier_2_asset_type_description', filtertype: 'checkedlist' },
			{ text:'UPC (Consumer Pk.)', 	width: '8%', datafield: 'tier_2_upc'},
			{ text:'Pack/Case', width: '5%', datafield: 'tier_2_qty_per_tier_3'},
			
			{ text:'Case', width: '8%', datafield: 'tier_3_asset_type_description', filtertype: 'checkedlist' },
			{ text:'UPC (Case)', 	width: '8%', datafield: 'tier_3_upc'},
			{ text:'Case/Pallet', width: '5%', datafield: 'tier_3_qty_per_tier_4'},		
			{ text: 'View', datafiefld: '_id', columntype: 'button', filterable:false, width:'75px', cellsrenderer: function (row) {
				var dataRecord = $("#jqxGrid").jqxGrid('getrowdata', row);			
				return 'View'
			}},			

		]
	});
	$.mobile.loading('hide');					

});

