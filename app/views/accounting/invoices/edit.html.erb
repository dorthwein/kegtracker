<div class="popup_title">	
	<h3> Edit Invoice Manifest </h3>
</div>
<%= render 'form' %>
<script>
	$(document).ready(function(){		
		var source = {
			datatype: "json",
			type: "GET",
			datafields: [
				{name: 'sku_description', type: 'string'},
				{name: 'quantity', type: 'number'},	
				{name: 'invoice_attached_asset_count', type: 'number'},				
				{name: '_id'},	
			], 
			url: location.href.substring(0, location.href.length - 4) + 'invoice_line_items',
		};

		window.dataAdapter = new $.jqx.dataAdapter(source, {
			beforeSend: function(jqXHR, settings){
				 	
			},
			loadComplete: function (data) {			
				 
			},
			loadError: function (xhr, status, error) { }

		});
		//	window.dataAdapter = dataAdapter
		// 	Initialize Grid

		$(".jqxGrid").jqxGrid({
			// Grid Options
			groupable: false,
			sortable: true,       
			filterable: false,
			showfilterrow: false,		
	        autoshowfiltericon: false,		
			theme: settings.theme,
			width: '100%',
			groupsexpandedbydefault: false,
			height:  200,
			source: dataAdapter,	
			columnsresize: true,
			altrows: true,		
			columns: [
				{text: 'SKU',  datafield: 'sku_description'},
				{text: 'Fullfilled',  datafield: 'invoice_attached_asset_count', width:100},
				{text: 'Qty',  datafield: 'quantity', width:100},
			]
		});

		$('#number').jqxInput({disabled: true})
		$('#quantity').jqxInput({width:50, height:20, rtl: false, theme: settings.theme})		
		
		$('#add_invoice_line_item').click(function () {
			 		
	        var params = {record: {}}
			
			params['record']['sku_id'] = $('#sku_id').jqxDropDownList('getSelectedItem').value
			params['record']['quantity'] = $('#quantity').val()

			$.ajax({
				type: "POST",
				dataType : "JSON",
				url: location.href.substring(0, location.href.length - 4) + 'invoice_line_items',
				data: params,
			}).done(function( data ) {						
				window.dataAdapter.dataBind();
			})
			 
		});

		$("#delete_invoice_line_item").click(function () {
			var rowindex = $('.jqxGrid').jqxGrid('getselectedrowindex');
			var rowdata = $('.jqxGrid').jqxGrid('getrowdata', rowindex);		

			$.ajax({
				type: "DELETE",
				dataType : "JSON",
				url: location.href.substring(0, location.href.length - 4) + 'invoice_line_items/' + rowdata['_id'],
			}).done(function( data ) {
				window.dataAdapter.dataBind();
			});		        	
		});
		$(".save").click(function () {
			if($('.jqxValidator').jqxValidator('validate') ){
				$('#add_to_invoice').empty()				
			}

		})
	})			
</script>